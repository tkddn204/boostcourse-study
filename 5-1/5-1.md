# 프로젝트 5-1. 예약관리시스템: 예약하기-백엔드

Created: Aug 8, 2019 11:14 PM
tags: 부스트코스,웹프로그래밍


## 서론

  아.. 이번 5-1 프로젝트에서는 이전과 달리 착오가 있어 fail 후 pass를 받았습니다. 이번 프로젝트를 통해 배운 학습 내용을 공유드립니다.


## 이번 프로젝트는?

  역시 제가 전에 해본 경험이 없다보니, 여러 부분에서 전전긍긍한 부분이 있었습니다. 크게 3가지 정도 배운 점이 있었습니다.

### DAO SQL Exception

  swagger에 따라 예약하기(_post_) API를 만드는 중에, DAO에서 자꾸만 SQL에러가 발생했습니다. 왜 그럴까 계속 생각하면서 `try-catch` 구문으로 스택트레이스를 보면서 분석했습니다. 다음과 같은 두 가지 이유가 겹쳐있어 오류가 발생했었습니다.

1. 기본 키(Primary Key) 오류

2. 존재하지 않는 외래 키(Foreign Key) 오류

   기본 키 오류는 객체(`ReservationParams`)를 사용하여 SQL에 들어가는 파라미터를 사용하다보니, 기본 키 필드에 0이 들어가 있어 오류가 발생했습니다. 저는 DAO의 필드에 생성한 `SimpleJdbcInsert`에 `.usingGeneratedKeyColumns("id")`를 추가하여 문제를 해결했습니다.

   존재하지 않는 외래 키 오류는 `ReservationPrice` 객체를 통해 쿼리를 보내고 있었는데, 보내기 전 서비스 단계에서 `ReservationParams`를 가공할 때 객체 안의 필드를 잘못(...) 매핑해서 값이 0으로 들어가 발생한 오류였습니다.

   혹시 저와 같은 오류를 경험(...)하신다면, 그 부분 그대로 집중하여 살펴보는 것보다, side effect가 있는지 천천히 살펴보는 것을.. 추천드립니다!

저는 `infinite` 속성을 가진 `left`를 이동하는 `animation`을 이용했고, 이 속성을 이용하면 **동적으로 html class를 생성해도 동작이 가능**하다는 점을 이용했습니다. 또, 무한으로 반복되는 것을 **단 한번**만 조절하기 위해, `animationiteration`을 이용하여 한 번의 이터레이션이 끝나면 html class를 없애도록 하였습니다. 알고리즘을 순서대로 말씀드리면,

### 리스트 stream

  사실 4-1에서도 `stream`을 이용하라는 리뷰어님의 말씀에 `for` 대신 쓰다가, 아래 제안 알림을 보고, `map` 함수에서 `peek`을 사용하게 되었습니다(저는 intellij를 사용중입니다.).

<img width="400px" src="/5-1/images/peek.png" alt="peek" />

  하지만, 리뷰어님께서 `peek`은 `stream`의 함수 중에서 **중간 단계** 함수로 사용되지, 이렇게 최종적으로 쓰이는 함수가 아니라고 설명해주셨습니다. 따라서 `peek` 대신에 `map`이나 `filter`를 사용하는 것으로 변경하였습니다.

### 이메일 세션 처리

  세션 처리는 강좌에서 알려준 것을 응용해서, 쿼리 결과가 1개 이상 있으면 세션을 생성하고, 없으면 redirect를 하도록 설정했습니다.



## Fail 이유?

  swagger에 보면 다음과 같이 **Random으로 보낸다고 쓰여있는데,** 개발할 때 랜덤 값으로 보내야 하는 것인가 혼동이 왔었습니다. 일단 쓰여 있는대로 랜덤 값으로 보내는 것으로 메소드를 작성했더니, 실제 개발할 때는 랜덤 값이 아닌 제대로 된 메소드를 작성해야 한다고 하시면서 Fail을 주셨었습니다..



## 결론

  프로젝트 5의 백엔드도 무사히 통과했습니다. 이번 프로젝트는 위에 말씀드린 세 가지 말고도, 배운 점이 많이 있었습니다. 5-2. 프론트엔드 글에서 뵙겠습니다. 읽어주셔서 감사합니다.


> /# 부스트코스 #웹프로그래밍